name: Run Vowel Evals

on:
  push:
  workflow_dispatch:

jobs:
  vowel-evals:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
    
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: '3.11'
    
    - name: Install vowel package
      run: |
        pip install vowel dotenv
    
    - name: Run vowel on all YAML files in evals directory
      run: |
        echo "Starting vowel evaluations..."
        YAML_FILES=$(find evals -name "*.yml" -type f)
        
        if [ -z "$YAML_FILES" ]; then
          echo "No YAML files found in evals directory"
          exit 1
        fi
        
        for yaml_file in $YAML_FILES; do
          echo ""
          echo "================================================"
          echo "Processing: $yaml_file"
          echo "================================================"
          vowel "$yaml_file" -v
          RESULT=$?
          if [ $RESULT -ne 0 ]; then
            echo "ERROR: vowel failed for $yaml_file with exit code $RESULT"
            exit $RESULT
          fi
          echo "SUCCESS: $yaml_file completed"
        done
        
        echo ""
        echo "All evaluations completed successfully!"
